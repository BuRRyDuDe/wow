[build]
builder = "dockerfile"

[deploy]
startCommand = "sh -c 'label-studio start --host 0.0.0.0 --port ${PORT:-8080} --data-dir /app/data'"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

[environments.production]
variables = {
  LABEL_STUDIO_HOST = "0.0.0.0",
  LABEL_STUDIO_DATA_DIR = "/app/data",
  LABEL_STUDIO_MEDIA_DIR = "/app/media",
  DJANGO_SETTINGS_MODULE = "label_studio.settings.label_studio",
  LABEL_STUDIO_DISABLE_SIGNUP_WITHOUT_LINK = "true",
  DATABASE_URL = "${{Postgres.DATABASE_URL}}",
  POSTGRES_DB = "${{Postgres.POSTGRES_DB}}",
  POSTGRES_USER = "${{Postgres.POSTGRES_USER}}",
  POSTGRES_PASSWORD = "${{Postgres.POSTGRES_PASSWORD}}",
  POSTGRES_HOST = "${{Postgres.POSTGRES_HOST}}",
  POSTGRES_PORT = "${{Postgres.POSTGRES_PORT}}",
  GOOGLE_APPLICATION_CREDENTIALS = "${{GoogleCloudStorage.GOOGLE_APPLICATION_CREDENTIALS}}",
  GCS_BUCKET_NAME = "${{GoogleCloudStorage.GCS_BUCKET_NAME}}"
}

[environments.production.services]
postgres = { plan = "hobby" }